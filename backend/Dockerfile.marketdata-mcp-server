FROM python:3.10-slim-buster

WORKDIR /app

# Copy the entire project structure into /app
COPY . /app

# Crucial: Add agenttrader and agenttrader/backend to PYTHONPATH
ENV PYTHONPATH="/app"

# Leverage layer caching by copying requirements first
RUN pip install --no-cache-dir -r /app/requirements.txt

# Run using the module flag from the /app/agenttrader/backend context
CMD ["python", "-m", "agenttrader.backend.app"]